var app=angular.module("dpApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"pages/home.html",controller:"dpHomeCtrl"}).state("404",{url:"/404",templateUrl:"pages/404.html"}).state("membersList",{url:"/members-list",templateUrl:"pages/members-list.html"}).state("aboutUs",{url:"/about-us",templateUrl:"pages/about-us.html"}).state("images",{url:"/images/:id",templateUrl:"pages/images.html",controller:"dpImageCtrl"}).state("wordpress",{url:"/wordpress",templateUrl:"pages/wordpress.html",controller:"dpWordPressCtrl"})}]),app.service("service.main",function(){var a=["Senthil","Kumar"];return{names:a}}),app.service("settings",function(){var a={sites:[{blogId:"7833828309523986982",blogURL:"http://www.desipixer.in/",category:1}]};return{maxResults:400,maxApiFeedResults:500,startIndex:1,blogName:"http://www.dp.in",blogId:"7833828309523986982",publish:a}}),app.service("service.auth",["$q",function(a){var b="AIzaSyAb3tFTPvsduIR2xopIVpYhwKMQ5ac_5Po",c="215192364453-1vbjuf6f3r0vka9b5q0hj2mqj212dr9o.apps.googleusercontent.com",d=function(){return b},e=a.defer(),f={getKey:function(){return b},getClientSecret:function(){return c},logMeIn:function(){var a=(this.getKey(),{client_id:this.getClientSecret(),immediate:!1,response_type:"token",scope:"http://www.blogger.com/feeds/"});gapi.auth.authorize(a,this.callbackFn)},callbackFn:function(a){this.accessToken=a.access_token,e.resolve(a)},getToken:function(){return this.logMeIn(),e.promise},getAuthToken:function(a){return null!=a?"Bearer ".concat(a.access_token):null},accessToken:null},g=function(){var a=[{k:"n75l%!FgW4QYGo(d)txM(vET*x)Vz&4#eOiA$&Bu2dESBF6SYJXA$a3LAmmD*6Fd",id:"123529464",url:"http://desipixer4all.wordpress.com"}];return a};return{getAuthKey:d,blogger:f,wpKeys:g}}]),app.service("service.url",["$http","service.auth","settings",function(a,b,c){var d=function(a){if(null!=a){var b="?";return Object.keys(a).forEach(function(c,d){b+=c.concat("=").concat(a[c]).concat("&")}),b.substring(0,b.length-1)}},e=function(a){return a=null!==a?a:c.blogId,"https://www.googleapis.com/blogger/v3/blogs/".concat(a).concat("/posts?fetchImages=true&key=").concat(b.getAuthKey())},f=function(a,b,e){b=null!==b?b:c.startIndex,e=null!==e?e:c.maxResults,a=null!==a?a:c.blogId;var f={"start-index":b,"max-results":e,alt:"json",callback:"JSON_CALLBACK"};return"https://www.blogger.com/feeds/".concat(a).concat("/posts/default").concat(d(f))},g=function(a){var c={key:b.getAuthKey(),url:a};return"https://www.googleapis.com/blogger/v3/blogs/byurl".concat(d(c))},h=function(a,b,e,g){if(void 0==g||""==g)return f(a,b,e);b=null!==b?b:c.startIndex,e=null!==e?e:c.maxResults,a=null!==a?a:c.blogId;var h={"start-index":b,"max-results":e,q:g,alt:"json",callback:"JSON_CALLBACK"};return"https://www.blogger.com/feeds/".concat(a).concat("/posts/default").concat(d(h))},i=function(a){return"https://www.googleapis.com/blogger/v3/blogs/".concat(a).concat("/posts")},j=function(a,e){a=a||"7833828309523986982";var f="https://www.googleapis.com/blogger/v3/blogs/"+a+"/posts";if(e){var g={fetchImages:!0,key:b.getAuthKey(),maxResults:c.maxApiFeedResults,pageToken:e};return f.concat(d(g))}var h="https://www.googleapis.com/blogger/v3/blogs/"+a+"/posts?fetchImages=true&key=AIzaSyBZvR46qyUilZ6Fl5vn9oPnLZtYHnqSknE&maxResults=500";return h};return{urlForBlogId:g,urlForBlogFeed:f,getApiFeedUrl:j,urlForBlogDetails:e,urlForSearchText:h,objToString:d,getPostUrl:i}}]),app.service("service.util",["$http","settings","service.url",function(a,b,c){this.sessionBlog=[];var d=function(a){var b=[],c=a.match(/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/g);return void 0!=c&&c.length>0&&c.forEach(function(a,c){var d=a.match(/(https?:\/\/.*\.(?:png|jpg))/gi);if(void 0!=d&&d.length>0&&-1!==d[0].indexOf("blogspot.com")){var e=d[0].split("/"),f=e.splice(e.length-2,1);largeIMG=d[0].replace(f,"s1600"),b.push(largeIMG)}}),b},e=function(a,b){if(void 0!=a){if(b=b||1,1==b){if(a.hasOwnProperty("feed")&&a.feed.hasOwnProperty("entry")){console.log("Entries : "+a.feed.entry.length);var c=[],e=a.feed.entry;return e.forEach(function(a,b){var e={};e.title=void 0!==a.title.$t?a.title.$t:null,e.link=void 0!==a.link?a.link[a.link.length-1].href:null,e.id=void 0!==a.id.$t?a.id.$t.match(/\d+/g)[1].concat("-").concat(a.id.$t.match(/\d+/g)[2]):null,e.images=void 0!==a.content.$t?d(a.content.$t):[],e.thumb=0!==e.images.length?e.images[0].replace("s1600","s480"):[],e.published=a.published.$t,e.updated=a.published.$t,c.push(e)}),this.sessionBlog=c,c}}else if(2==b){var c=[],e=a.items;return console.log("Entries : "+a.items.length),e.forEach(function(a,b){if(void 0!=a){var e={};e.title=a.title,e.images=d(a.content),e.thumb=JSON.parse(JSON.stringify(e.images).replace(/s1600/g,"s480"))[0],e.id=a.id,e.published=new Date(a.published).getTime(),e.updated=new Date(a.updated).getTime(),e.link=a.url,c.push(e)}}),this.sessionBlog=c,c}return[]}},f=function(a,b){var c=[];if(0==a.length)return[];if(void 0==a)return[];if(b=b||1,1==b)a.forEach(function(a,b){if(void 0!==a){var e={};e.title=void 0!==a.title.$t?a.title.$t:null,e.link=void 0!==a.link?a.link[a.link.length-1].href:null,e.id=void 0!==a.id.$t?a.id.$t.match(/\d+/g)[1].concat("-").concat(a.id.$t.match(/\d+/g)[2]):null,e.images=void 0!==a.content.$t?d(a.content.$t):[],e.thumb=0!==e.images.length?e.images[0].replace("s1600","s480"):[],e.published=a.published.$t,e.updated=a.published.$t,c.push(e)}});else if(2==b&&void 0!=value){var e={};return e.title=value.title,e.images=d(value.content),e.thumb=JSON.parse(JSON.stringify(e.images).replace(/s1600/g,"s320")),e.id=value.id,e.published=new Date(value.published).getTime(),e.updated=new Date(value.updated).getTime(),e.link=value.url,e}return this.sessionBlog=c,c},g=function(b){return a.get(c.urlForBlogId(b))},h=function(b,d){var e=c.urlForSearchText(b,null,null,d);return a.jsonp(e)},i=function(b,d,e,f){if(f=f||1,1==f){var g=c.urlForBlogFeed(b,d,e);return a.jsonp(g)}if(2==f){var g=c.getApiFeedUrl(b,null);return a.get(g)}};return{getEntries:i,processBlogObj:e,searchSite:g,searchText:h,sessionBlog:this.sessionBlog,processBlogEntries:f}}]),app.service("service.sites",function(){var a=[{blogId:"7833828309523986982",blogURL:"http://www.desipixer.in/",category:1},{blogId:"3079987222818050451",blogURL:"http://movies.cinema65.com/",category:1},{blogId:"4846859112009281783",blogURL:"http://rockingfunimages.blogspot.com/",category:1},{blogId:"719302156971941098",blogURL:"http://hq-bollywood.blogspot.com/",category:1},{blogId:"1579799827781024268",blogURL:"http://www.telugupeopleadda.com/",category:1},{blogId:"5935905342569794143",blogURL:"http://sabhothimages.blogspot.com/",category:1},{blogId:"3293309843232706023",blogURL:"http://www.searchtamilmovies.com/",category:1},{blogId:"2951969169923408846",blogURL:"http://fultohot.blogspot.com/",category:1},{blogId:"4846859112009281783",blogURL:"http://www.celebsnext.com/",category:2},{blogId:"4040041419446016295",blogURL:"http://cinewaaradhi.blogspot.com",category:1},{blogId:"2222622162581355396",blogURL:"http://www.tufan9.com/",category:1},{blogId:"5338625676592862668",blogURL:"http://cinytown.blogspot.com/",category:1},{blogId:"3430584311590741572",blogURL:"http://tollywoodboost.blogspot.com/",category:1},{blogId:"5186853171678363994",blogURL:"https://latestmovieimagess.blogspot.com",category:1},{blogId:"4758457913364204558",blogURL:"http://cinestargallery.blogspot.com/",category:1},{blogId:"3512841850294928870",blogURL:"http://bollywoodtadkamasala.blogspot.com/",category:2}];return{sites:a}}),app.service("service.post",["service.auth","service.util","service.url","$http","$q","settings",function(a,b,c,d,e,f){var g=function(a,b){var c="";if(a.length>0){var d=b;c="<div>",a.forEach(function(a,b){c=c.concat("<img src='").concat(a).concat("' title='").concat(d).concat("' class='desipixer' />")}),c+="</div>"}return c},h=function(){return console.log("called login service"),a.blogger.getToken()},i=function(){return a.blogger.accessToken()},j=function(a,b){var c=a.title,d=a.images,e=g(d,c);return k(e,c,b)},k=function(b,d,e){var g=f.publish.sites[0].blogId,h=c.getPostUrl(g),i={content:b,title:d},j={headers:{Authorization:a.blogger.getAuthToken(e)}};return l(h,i,j)},l=function(a,b,c){var f=e.defer();return d.post(a,b,c).success(function(a,b){f.resolve(a)}).error(function(a){console.log(a)}),f.promise};return{getPostObj:k,createPostRequest:j,loggedIn:i,login:h,publishPost:l,generatePostHTML:g}}]);var clipboard=new Clipboard(".btn");document.onkeydown=function(a){8==a.keyCode&&"TEXTAREA"!=e.target.tagName&&"INPUT"!=e.target.tagName&&(a.preventDefault(),history.back(-1))},app.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),app.controller("dpMainCtrl",["$scope","service.sites","service.main",function(a,b,c){a.sites=b.sites,a.names=c.names}]),app.controller("dpHomeCtrl",["$scope","service.sites","service.util","settings","$http","$interval","service.post",function(a,b,c,d,e,f,g){function h(a,b){var c="mja3FL5dcUVKeVF5!$u3IvE6SPZYuVfef)g9cr2Tm0is2F7FMvlCCs(PfWdI0&eP",d="https://public-api.wordpress.com/rest/v1/sites/109226478/posts/new",f=a.title,h=g.generatePostHTML(a.images,a.title);a.images.length>1&&e({method:"POST",url:d,data:{title:f,content:h},headers:{Authorization:"Bearer "+c}}).success(function(a){console.log("Posted Item :"+b),console.log(a)}).error(function(a){console.log(a)})}a.title="Home Page",a.sites=b.sites,a.startIndex=d.startIndex,c.sessionBlog.length>0?a.entries=c.sessionBlog:c.getEntries(null,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b,1);a.entries=d}).error(function(a){console.log(a)}),a.selSiteChange=function(){var d=_.filter(b.sites,function(b){return b.blogId==a.selSite});d&&(d=d[0].category),console.log("blog category "+d),c.getEntries(a.selSite,null,null,d).success(function(b){var e=c.processBlogObj(b,d);a.entries=e}).error(function(a){console.log(a)})},a.searchSite=function(){c.searchSite(a.txtSearchSite).success(function(b){a.selSite=b.id,a.selSiteChange();var c={blogId:b.id,blogURL:a.txtSearchSite,category:1};console.log(c.toString())}).error(function(a){console.log("Error during searching site : "+a)})},a.searchKeyWords=function(){var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.searchText(b,a.txtSearch).success(function(b){var d=c.processBlogObj(b);a.entries=d})},a.getPreviousPosts=function(){if(!(d.startIndex<=1)){a.startIndex=d.startIndex-=d.maxResults;var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.getEntries(b,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)})}},a.getNextPosts=function(){a.startIndex=d.startIndex+=d.maxResults;var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.getEntries(b,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)})},a.titleSort=function(){c.sessionBlog=a.entries=_.sortBy(a.entries,function(a){return a.title})},a.shuffleArray=function(){c.sessionBlog=a.entries=_.shuffle(a.entries)},a.getWPAuth=function(){var a="https://public-api.wordpress.com/rest/v1/sites/109226478/posts/new";e({method:"POST",url:a,data:{title:"Hi-Title-New"},headers:{Authorization:"Bearer mja3FL5dcUVKeVF5!$u3IvE6SPZYuVfef)g9cr2Tm0is2F7FMvlCCs(PfWdI0&eP"}}).success(function(a){console.log(a)}).error(function(a){console.log(a)})},a.postAllToWordpress=function(){var b=(a.entries,a.entries.length-1),c=a.entries.length;setInterval(function(){c>0&&(h(a.entries[b--],b),c--)},200)},a.shareToGplus=function(a){console.log(a);var b="https://plus.google.com/share?url=".concat(a.link),c=window.open(b,"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");c.focus()}}]),app.controller("dpWordPressCtrl",["$scope","service.sites","service.util","settings","$http","$interval","service.post","service.url","service.auth",function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return a.length<0?void console.log("syncPostToWP() >> Entries are empty"):void(void 0!==b&&void 0!==c&&(console.log("PROCESSING SYNCHRONOUS POSTING"),k(a,b,c)))}function k(a,b,c){var d=c;if(!(b>d)){var f="https://public-api.wordpress.com/rest/v1/sites/"+p+"/posts/new",h=a[d].title,i=g.generatePostHTML(a[d].images,a[d].title);e({method:"POST",url:f,data:{title:h,content:i},headers:{Authorization:"Bearer "+q}}).success(function(b){console.log("postEntriesSync() >> POSTED : "+d),console.log(b),k(a,--d,c)}).error(function(b){++m.errCount,console.log("postEntriesSync() >> ERROR :"+b),m.errCount<15&&k(a,--d,c)})}}function l(b,d,f,g,i){var j=h.urlForBlogFeed(b,d,500);e.jsonp(j).success(function(e){var h=e.feed.entry;if(g=g.concat(h),f>d)d+=500,console.log("startIndex : "+d),console.log("entries length : "+g.length),l(b,d,f,g,i);else{console.log(g.length),console.log(g[0]);var j=a.allEntries=c.processBlogEntries(g);1==i&&a.postAllToWordpress(j)}}).error(function(a){console.log("err: "+a)})}a.title="Wordpress Page",a.sites=b.sites,a.startIndex=d.startIndex,a.totalItems=0,a.allEntries=[];var m={errCount:10},n=i.wpKeys();console.log(n);var o=n[0],p=o.id,q=o.k;c.sessionBlog.length>0?a.entries=c.sessionBlog:c.getEntries(null,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)}),a.selSiteChange=function(){c.getEntries(a.selSite,null,null).success(function(b){a.totalEntries=b.feed.entry.length;var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)})},a.searchSite=function(){c.searchSite(a.txtSearchSite).success(function(b){a.selSite=b.id,a.totalItems=b.posts.totalItems,a.selSiteChange();var c={blogId:b.id,blogURL:a.txtSearchSite,category:1};console.log(c)}).error(function(a){console.log("Error during searching site : "+a)})},a.searchKeyWords=function(){var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.searchText(b,a.txtSearch).success(function(b){var d=c.processBlogObj(b);a.entries=d})},a.getPreviousPosts=function(){if(!(d.startIndex<=1)){a.startIndex=d.startIndex-=d.maxResults;var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.getEntries(b,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)})}},a.getNextPosts=function(){a.startIndex=d.startIndex+=d.maxResults;var b=void 0!==a.selSite.blogId?a.selSite.blogId:a.selSite;c.getEntries(b,d.startIndex,d.maxResults).success(function(b){var d=c.processBlogObj(b);a.entries=d}).error(function(a){console.log(a)})},a.titleSort=function(){c.sessionBlog=a.entries=_.sortBy(a.entries,function(a){return a.title})},a.getUniqueImages=function(a){return _.uniq(a)},a.shuffleArray=function(){c.sessionBlog=a.entries=_.shuffle(a.entries)},a.getWPAuth=function(){var a="https://public-api.wordpress.com/rest/v1/sites/"+p+"/posts/new";e({method:"POST",url:a,data:{title:"Hi-Title-New"},headers:{Authorization:"Bearer mja3FL5dcUVKeVF5!$u3IvE6SPZYuVfef)g9cr2Tm0is2F7FMvlCCs(PfWdI0&eP"}}).success(function(a){console.log(a)}).error(function(a){console.log(a)})},a.postAllToWordpress=function(b){if(console.log("postAllToWordpress called"),a.isLimitedPosts){var c=parseInt(a.postStartIndex)||0,d=parseInt(a.postEndIndex)||b.length;a.allEntries=a.allEntries.slice(c,d+1)}console.log("TOTAL ENTRIES TO POST : "+b.length),j(b,0,b.length-1)},a.postAll=function(){var b=[],c=a.totalItems;console.log("selSite : "+a.selSite),console.log("totalItems : "+a.totalItems),l(a.selSite,1,c,b,!0)},a.getAllPosts=function(){var b=[],c=a.totalItems;l(a.selSite,1,c,b,!1)},a.ran_col=function(){var a="#",b=["000000","FF0000","00FF00","0000FF","FFFF00","00FFFF","FF00FF","C0C0C0"];a+=b[Math.floor(Math.random()*b.length)],document.getElementById("page-title").style.background=a}}]),app.controller("dpImageCtrl",["$scope","$stateParams","service.util","service.post","$http",function(a,b,c,d,e){var f=void 0!==b.id?b.id:"default",g=_.filter(c.sessionBlog,function(a){return a.id==f});g.length>0&&(g[0].images=_.uniq(g[0].images)),a.postObj=g.length>0?g[0]:[],a.postContent=d.generatePostHTML(a.postObj.images,a.postObj.title),a.publishPost=function(){d.login().then(function(b){d.createPostRequest(a.postObj,b).then(function(a){angular.element(document.querySelector("#divPostStatus")).text("POSTED"),console.log(a)},function(a){angular.element(document.querySelector("#divPostStatus")).text("ERROR"),console.log(a)})},function(a){console.log(a)})},a.goToUrl=function(){var b=a.postObj.link,c=window.open(b,"_blank");c.focus()},a.shareToGplus=function(){var b="https://plus.google.com/share?url=".concat(a.postObj.link),c=window.open(b,"_blank","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600");c.focus()},a.downloadAllImages=function(){a.postObj.images.forEach(function(a,b){var c=document.createElement("a");c.href=a,c.download="Download.jpg",document.body.appendChild(c),c.click()})},a.publishToWordpress=function(){var b="mja3FL5dcUVKeVF5!$u3IvE6SPZYuVfef)g9cr2Tm0is2F7FMvlCCs(PfWdI0&eP",c="https://public-api.wordpress.com/rest/v1/sites/109226478/posts/new",f=a.postObj.title,g=d.generatePostHTML(a.postObj.images,a.postObj.title);e({method:"POST",url:c,data:{title:f,content:g},headers:{Authorization:"Bearer "+b}}).success(function(a){console.log(a)}).error(function(a){console.log(a)})}}]);